{% extends "base.html" %}
{% block content %}
<h2>Physical Closing (Protected)</h2>

<!-- Store selection -->
<form method="get" class="mb-3">
  <div class="row g-3">
    <div class="col-md-3">
      <label for="store_id" class="form-label">Store</label>
      <select name="store_id" id="store_id" onchange="this.form.submit()" class="form-select">
        <option value="">-- Select Store --</option>
        {% for sid in stores %}
          <option value="{{ sid }}" {% if selected_store == sid|string %}selected{% endif %}>
            {{ sid }}
          </option>
        {% endfor %}
      </select>
    </div>
  </div>
</form>

{% if not selected_store %}
  <div class="alert alert-info">Please select a store to begin closing entry.</div>
{% elif ingredients|length == 0 %}
  <div class="alert alert-warning">‚ö†Ô∏è No ingredients mapped for this store.</div>
{% else %}
<form method="post">
  <input type="hidden" name="store_id" value="{{ selected_store }}">

  <div class="row mb-3">
    <div class="col-md-3">
      <label for="date" class="form-label">Date</label>
      <input type="date" id="date" class="form-control" name="date" required>
    </div>
    <div class="col-md-3">
      <label for="secret" class="form-label">Secret Phrase</label>
      <input type="password" id="secret" class="form-control" name="secret" required>
    </div>
  </div>

  <table class="table table-bordered table-sm">
    <thead class="table-light">
      <tr>
        <th>Ingredient</th>
        <th>Closing</th>
      </tr>
    </thead>
    <tbody>
      {% for ing in ingredients %}
      <tr>
        <td>
          {{ ing }}
          <input type="hidden" name="ingredient_name[]" value="{{ ing }}">
        </td>
        <td>
          <input type="number" step="0.01" class="form-control form-control-sm" name="closing[]" value="0">
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button class="btn btn-danger">üîí Save Closing</button>
</form>
{% endif %}
{% endblock %}
